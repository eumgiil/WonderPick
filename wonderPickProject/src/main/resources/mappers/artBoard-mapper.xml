<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="artBoardMapper">

	<resultMap id="board" type="board">
		<result column="BOARD_NO" property="boardNo" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="BOARD_TITLE" property="boardTitle" />
		<result column="BOARD_CONTENT" property="boardContent" />
		<result column="CREATE_DATE" property="createDate" />
		<result column="STATUS" property="status" />
		<result column="BOARD_COUNT" property="boardCount" />
		<result column="BOARD_TYPE" property="boardType" />
	</resultMap>
	
	<resultMap id="artBoard" type="artBoard">
		<result column="FILE_TYPE" property="fileType" />
		<result column="DPI" property="dpi" />
		<result column="DEFAULT_SIZE" property="defaultSize" />
		<result column="MODIFY_COUNT" property="modifyCount" />
		<result column="WORKDAY" property="workday" />
		<result column="CATEGORY" property="category" />
		<result column="PRICE" property="price" />
	</resultMap>
	

	
	<resultMap id="review" type="review">
		<result column="REVIEW_NO" property="reviewNo" />
		<result column="BOARD_NO" property="boardNo" />
		<result column="MEMBER_NO" property="memberNo" />
		<result column="STAR" property="star" />
		<result column="ORIGIN_NAME" property="originName" />
		<result column="MODIFY_NAME" property="modifyName" />
	</resultMap>

	

	<resultMap id="artBoardDTO" type="com.kh.wonderPick.board.artBoard.model.vo.ArtBoardDTO">
		<result column="BOARD_NO" property="boardNo" />
		<result column="BOARD_TITLE" property="boardTitle" />
		<result column="NICKNAME" property="nickname" />
		<result column="PRICE" property="price" />
		<result column="STAR" property="star" />
		<result column="MODIFY_NAME" property="modifyName" />
	</resultMap>

	<select id="selectArtListCount" resultType="_int">
		select
		       count(*)
		  from
		       board
		 where
		 	   board_type = 'D'
		   and
		 	   status = 'Y'
	</select>
	
	<select id="selectArtList" resultMap="artBoardDTO">
		select 
		       b.board_no
		      ,b.board_title
		      ,m.nickname
		      ,NVL(ab.price, 0) price
		      ,AVG(NVL(r.star, 0))
		      ,bi.modify_name bi
		  from
		       board b
		  join
		       member m on(b.member_no = m.member_no)
		  join
		       art_board ab on(b.board_no = ab.board_no)
		  left join
		       review r on(b.board_no = r.board_no)
		  join
		       board_image bi on(bi.board_no = b.board_no)
	     where 
	     	   b.status = 'Y'
           and
               bi.file_level = '1'
		 group by
		       b.board_no, b.board_title, m.nickname, price, bi.modify_name
		 order by
		       board_no desc
	</select>

	<insert id="insertBoard" parameterType="board">
		insert
		  into
		  	   board
		  	   (
		  	   board_no,
		  	   member_no,
		  	   board_title,
		  	   board_content,
		  	   create_date,
		  	   status,
		  	   board_count,
		  	   board_type
		  	   )
		values
			   (
			   seq_board_no.nextval,
			   1,
               #{boardTitle},
               #{boardContent},
               default,
               default,
               default,
               'D'
			   )
	</insert>

	<insert id="insertArtBoard" parameterType="artBoard">
		insert
		  into
		  	   art_board
		  	   (
		  	   BOARD_NO,
		  	   FILE_TYPE,
		  	   DPI,
		  	   DEFAULT_SIZE,
		  	   MODIFY_COUNT,
		  	   WORKDAY,
		  	   CATEGORY,
		  	   PRICE
		  	   )
		values
			   (
			   seq_board_no.currval,
			   #{fileType},
               #{dpi},
               #{defaultSize},
               #{modifyCount},
               #{workday},
               #{category},
               #{price}
			   )
	</insert>
	
	<insert id="insertOptions" parameterType="option">
		insert
		  into
		  	   art_option
		  	   (
		  	   OPTION_NO
		  	  ,BOARD_NO
		  	  ,MAIN_OPTION
		  	  ,DETAIL_OPTION
		  	  ,PRICE
		  	   )
		values
			   (
		       SEQ_OPTION_NO.nextval
		      ,seq_board_no.currval
		      ,#{mainOp}
		      ,#{detail}
		      ,#{price}
			   )
	</insert>
	
	<insert id="insertFiles" parameterType="boardImage">
		insert
		  into
		  	   board_image
		  	   (
		  	   BOARD_IMG_NO
		  	  ,BOARD_NO
		  	  ,ORIGIN_NAME
		  	  ,MODIFY_NAME
		  	  ,UPLOAD_DATE
		  	  ,FILE_LEVEL
		  	  ,FILE_PATH
		  	   )
		values
			   (
		       seq_boardimg_no.nextval
		      ,seq_board_no.currval
		      ,#{originName}
		      ,#{modifyName}
		      ,sysdate
		      ,#{fileLevel}
		      ,#{filePath}
			   )
	</insert>




















</mapper>
	
	
	
	